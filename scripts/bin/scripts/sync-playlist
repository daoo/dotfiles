#!/usr/bin/env python

import os
import sys

if len(sys.argv) != 5:
    sys.stderr.write("USAGE: %s source.m3u source-root target.m3u target-root\n" % sys.argv[0])
    sys.exit(1)

source_path = sys.argv[1]
source_root = sys.argv[2]
target_path = sys.argv[3]
target_root = sys.argv[4]

with open(source_path) as file:
    paths = file.readlines()

relatives = (os.path.relpath(path, source_root) for path in paths)
targets = (os.path.join(target_root, path) for path in relatives)

with open(target_path, "w") as file:
    file.writelines(targets)
