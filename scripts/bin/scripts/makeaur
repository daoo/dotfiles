#!/usr/bin/env bash

set -euo pipefail

if [[ $# -ne 1 ]]; then
  echo "Usage: $0 <aur-package-name>"
  exit 1
fi

PKGNAME="$1"
AUR_URL="https://aur.archlinux.org/cgit/aur.git/snapshot/${PKGNAME}.tar.gz"

# Create temp dir and clean up on exit
WORKDIR="$(mktemp -d)"
cleanup() {
  rm -rf "$WORKDIR"
}
trap cleanup EXIT

echo "Downloading PKGBUILD snapshot for $PKGNAME..."
curl -L "$AUR_URL" -o "$WORKDIR/${PKGNAME}.tar.gz"

echo "Extracting..."
tar -xzf "$WORKDIR/${PKGNAME}.tar.gz" -C "$WORKDIR"

cd "$WORKDIR/$PKGNAME"

echo "Building package..."
makepkg -s --noconfirm

echo "Installing package..."
sudo pacman -U --noconfirm ./*.pkg.tar.*

echo "Done!"
